zerops:
  - setup: ubuntu
    build:
      base: nodejs@20  # Stick with 20, solid for most setups (or bump to @22 if OpenClaw needs it)
      prepareCommands:
        - sudo apt-get update
        - sudo apt-get install -y git  # Keep if you need git/submodules; remove if not
        # Add more system packages here if OpenClaw needs them (e.g. for Puppeteer/Chromium):
        # - sudo apt-get install -y chromium-browser libnss3 libgconf-2-4
      buildCommands:
        - corepack enable                  # Enables pnpm properly
        - corepack prepare pnpm@latest --activate
        - pnpm install --frozen-lockfile    # Clean, production-ready install
        # If OpenClaw has a build script (e.g. TS compile), uncomment:
        # - pnpm run build
      deployFiles: .                       # Deploys full project
      cache:
        - node_modules
        - .pnpm-store                      # Speeds up future builds massively
    run:
      base: nodejs@20
      # No ports needed if OpenClaw has no web UI/dashboard (remove if not exposing anything)
      # ports:
      #   - port: 3000
      #     httpSupport: true
      mount:
        - storage: openclawdata            # ← Must EXACTLY match your Shared Storage service name (case-sensitive, no spaces/dashes usually)
          path: /data                      # Mounts persistent storage here for state/memory
      initCommands:
        - mkdir -p /data
        - chown -R zerops:zerops /data || true
        # If first run needs setup (e.g. generate default config), add:
        # - pnpm run setup || true
      start: pnpm start                    # ← Confirm this matches your package.json scripts!
                                   # Common alternatives from OpenClaw repos:
                                   # - node openclaw.mjs
                                   # - pnpm run agent
                                   # - pnpm dev (for testing)
      envVariables:
        NODE_ENV: production
        OPENCLAW_PREFER_PNPM: "1"
        OPENCLAW_STATE_DIR: "/data"
        NODE_OPTIONS: "--max-old-space-size=1536"
        # Add your LLM keys/secrets via Zerops dashboard (never commit them!)
